{% extends template %}
{% block content %}

<h1>FUNDRS in your area!</h1>
<hr>
<h1>Fundraiser List</h1>
<div id="board">
  <div class="card">
    <span class="card-title h3 accent-clr" id="fundr-name"></span>
    <p id="fundr-bio"></p>
    <p id="fundr-funded"></p>
    {% if template == "base-desktop.html" %}
      <div style="display:inline">
        <button id="next-button" style="margin-right: 30%;">Next</button>
        <button id="save-button"  style="margin-left: 30%;" onclick="document.getElementById('next-button').click()">Save</button>
        <form action="{% url 'save_fundr' fundr.id user.id %}" method="POST">
          {% csrf_token %}
          <button type="submit" class="btn" onclick="document.getElementById('next-button').click()">Save</button>
        </form>
      </div>
    {% else %}
      <button id="next-button" style="width: 100vw; height: 100vh; border: none; outline: none; position: fixed; top: 0; left: 0; background: transparent"></button>
    {% endif %}
  </div>
</div>



<script>
  document.addEventListener("DOMContentLoaded", function() {
    let currentIndex = 0;
    const fundrs = JSON.parse(JSON.parse('{{ fundrs|escapejs }}'));
    const nextButton = document.getElementById("next-button");
    const saveButton = document.getElementById("save-button");
    const fundrName = document.getElementById("fundr-name");
    const fundrBio = document.getElementById("fundr-bio");
    const fundrFunded = document.getElementById("fundr-funded");

    fundrName.innerText = fundrs[currentIndex].fields.name;
    fundrBio.innerText = fundrs[currentIndex].fields.bio;
    let currentFunded = fundrs[currentIndex].fields.current;
    let goal = fundrs[currentIndex].fields.goal;
    if (currentFunded == goal) {
      fundrFunded.innerText = `Fully Funded: ${goal}!`;
    }
    else {
      fundrFunded.innerText = `${currentFunded} funded out of ${goal}`;
    }


    nextButton.addEventListener("click", function() {
        currentIndex++;
        if (currentIndex < fundrs.length) {
          let fundrObj = fundrs[currentIndex]
          fundrName.innerText = fundrObj.fields.name;
          fundrBio.innerText = fundrObj.fields.bio;
          currentFunded = fundrs[currentIndex].fields.current;
          goal = fundrs[currentIndex].fields.goal;

          if (currentFunded == goal) {
            fundrFunded.innerText = `Fully Funded: ${goal}!`;
          } else {
            fundrFunded.innerText = `${currentFunded} funded out of ${goal}`;
          }
        }
        else {
          fundrName.innerText = "No more Fundrs to show!";
          fundrBio.style.display = "none";
          fundrFunded.style.display = "none";
          nextButton.style.display = "none";
        }
    });
  });
</script>


{% endblock %}